<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cppcheck XML Viewer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<h2>Cppcheck XML Viewer</h2>

<div class="header">
  <div class="file-input-wrapper">
    <input type="file" id="fileInput" accept=".xml" />
    <label for="fileInput" class="file-input-label ripple">
      Choose XML File
    </label>
    <button id="reloadBtn" class="reload-btn" style="display: none;">
      ↻ Reload
    </button>
    <span class="file-name" id="fileName"></span>
  </div>
  <div class="workspace-input-inline">
      <label for="workspaceRoot" title="Enter the root directory of your workspace. This allows you to click on file paths in the table to open them directly in VS Code.">Workspace Root</label>
      <input
        type="text"
        id="workspaceRoot"
        placeholder="e.g. C:/projects/myrepo"
      />
  </div>
</div>

<div class="tabs-container">
  <button class="tab-btn active" data-tab="errors">Errors</button>
  <button class="tab-btn" data-tab="summary">Summary</button>
  <button class="tab-btn" data-tab="byLocation">By Location</button>
  <button class="tab-btn compare-tab-btn" data-tab="compare" style="display: none;">Compare</button>
</div>

<div id="errorsTab" class="tab-content active">
<div class="filters-section collapsed">
  <div class="filters-header" onclick="toggleFilters(this.parentElement)">
    <h3>Filters</h3>
    <span class="collapse-icon">▼</span>
  </div>
  <div class="filters-content">
  <div class="filters-row">
    <div class="filter-item">
      <label for="guidelineFilter">Guideline</label>
      <div class="multiselect-wrapper" id="guidelineFilterWrapper">
        <div class="multiselect-input-container">
          <div class="multiselect-selected-chips" id="guidelineSelectedChips"></div>
          <input
            type="text"
            id="guidelineFilterSearch"
            class="multiselect-search"
            placeholder="Search guidelines..."
            autocomplete="off"
          />
        </div>
        <div class="multiselect-dropdown" id="guidelineFilterDropdown"></div>
      </div>
    </div>

    <div class="filter-item">
      <label for="locationFilter">Location</label>
      <div class="multiselect-wrapper" id="locationFilterWrapper">
        <div class="multiselect-input-container">
          <div class="multiselect-selected-chips" id="locationSelectedChips"></div>
          <input
            type="text"
            id="locationFilterSearch"
            class="multiselect-search"
            placeholder="Search locations..."
            autocomplete="off"
          />
        </div>
        <div class="multiselect-dropdown" id="locationFilterDropdown"></div>
      </div>
    </div>
  </div>
  <button id="resetFiltersBtn" class="reset-filters-btn">Reset Filters</button>
  </div>
</div>

<div id="statsSection">
  <h3>Error Statistics</h3>
  <div class="stats-container">
    <div class="stat-item">
      <span class="stat-label">Total Errors</span>
      <span class="stat-value" id="totalCount">0</span>
    </div>
    <div id="classificationCounts">
    </div>
  </div>
</div>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th>Guideline</th>
        <th>Classification</th>
        <th>Message</th>
        <th>File</th>
        <th>Line</th>
        <th>Col</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>
</div>

<div id="summaryTab" class="tab-content">
<div id="summaryStatsSection">
  <h3>Summary Statistics</h3>
  <div class="stats-container">
    <div class="stat-item">
      <span class="stat-label">Total Errors</span>
      <span class="stat-value" id="summaryTotalCount">0</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Unique Guidelines</span>
      <span class="stat-value" id="uniqueGuidelinesCount">0</span>
    </div>
  </div>
</div>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th>Guideline</th>
        <th>Classification</th>
        <th>Count</th>
      </tr>
    </thead>
    <tbody id="summaryTableBody"></tbody>
  </table>
</div>
</div>

<div id="byLocationTab" class="tab-content">
<div id="locationStatsSection">
  <h3>Location Summary Statistics</h3>
  <div class="stats-container">
    <div class="stat-item">
      <span class="stat-label">Total Errors</span>
      <span class="stat-value" id="locationTotalCount">0</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Unique Locations</span>
      <span class="stat-value" id="uniqueLocationsCount">0</span>
    </div>
  </div>
</div>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th>Location</th>
        <th>Total Errors</th>
        <th>Unique Errors</th>
        <th>Mandatory</th>
        <th>Required</th>
        <th>Advisory</th>
      </tr>
    </thead>
    <tbody id="locationSummaryTableBody"></tbody>
  </table>
</div>
</div>

<div id="compareTab" class="tab-content">
  <h3>Compare</h3>
  
  <div class="compare-controls-wrapper">
    <div class="file-input-wrapper">
      <input type="file" id="baselineFileInput" accept=".xml" />
      <label for="baselineFileInput" class="file-input-label ripple">
        Load Baseline XML
      </label>
      <span class="file-name" id="baselineFileName"></span>
    </div>

    <div class="comparison-level-container">
      <label for="comparisonLevel">Comparison Level:</label>
      <div class="slider-content-wrapper">
        <div class="slider-wrapper">
          <input type="range" id="comparisonLevel" min="1" max="3" value="2" step="1" />
          <div class="slider-labels">
            <span>Guideline</span>
            <span>+ File</span>
            <span>+ Lines</span>
          </div>
        </div>
        <div class="slider-explanation">
          Lines option: Matches errors where guideline, file, and line/column match, with only line OR only column differing
        </div>
      </div>
    </div>
  </div>

<div class="filters-section collapsed">
  <div class="filters-header" onclick="toggleFilters(this.parentElement)">
    <h3>Filters</h3>
    <span class="collapse-icon">▼</span>
  </div>
  <div class="filters-content">
  <div class="filters-row">
    <div class="filter-item">
      <label for="compareStatusFilter">Status</label>
      <div class="multiselect-wrapper" id="compareStatusFilterWrapper">
        <div class="multiselect-input-container">
          <div class="multiselect-selected-chips" id="compareStatusSelectedChips"></div>
          <input
            type="text"
            id="compareStatusFilterSearch"
            class="multiselect-search"
            placeholder="Search status..."
            autocomplete="off"
          />
        </div>
        <div class="multiselect-dropdown" id="compareStatusFilterDropdown"></div>
      </div>
    </div>

    <div class="filter-item">
      <label for="compareGuidelineFilter">Guideline</label>
      <div class="multiselect-wrapper" id="compareGuidelineFilterWrapper">
        <div class="multiselect-input-container">
          <div class="multiselect-selected-chips" id="compareGuidelineSelectedChips"></div>
          <input
            type="text"
            id="compareGuidelineFilterSearch"
            class="multiselect-search"
            placeholder="Search guidelines..."
            autocomplete="off"
          />
        </div>
        <div class="multiselect-dropdown" id="compareGuidelineFilterDropdown"></div>
      </div>
    </div>

    <div class="filter-item">
      <label for="compareFileFilter">File</label>
      <div class="multiselect-wrapper" id="compareFileFilterWrapper">
        <div class="multiselect-input-container">
          <div class="multiselect-selected-chips" id="compareFileSelectedChips"></div>
          <input
            type="text"
            id="compareFileFilterSearch"
            class="multiselect-search"
            placeholder="Search files..."
            autocomplete="off"
          />
        </div>
        <div class="multiselect-dropdown" id="compareFileFilterDropdown"></div>
      </div>
    </div>
  </div>
  <button id="resetCompareFiltersBtn" class="reset-filters-btn">Reset Filters</button>
  </div>
</div>
  
  <div id="comparisonStatsSection">
    <h3>Comparison Statistics</h3>
    <div class="stats-container">
      <div class="stat-item">
        <span class="stat-label">New Errors</span>
        <span class="stat-value" id="newErrorsCount">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Fixed Errors</span>
        <span class="stat-value" id="fixedErrorsCount">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Potentially Moved</span>
        <span class="stat-value" id="movedErrorsCount">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Total Changes</span>
        <span class="stat-value" id="totalChangesCount">0</span>
      </div>
    </div>
  </div>
  
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Status</th>
          <th>Guideline</th>
          <th>Classification</th>
          <th>Message</th>
          <th>File</th>
          <th>Line</th>
          <th>Col</th>
        </tr>
      </thead>
      <tbody id="comparisonTableBody"></tbody>
    </table>
  </div>
</div>

<!-- Violation Combinations Modal -->
<div id="violationCombinationsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalFileName">Violation Combinations</h3>
      <button class="modal-close" id="modalCloseBtn">&times;</button>
    </div>
    <div class="modal-body">
      <div id="modalContent"></div>
    </div>
  </div>
</div>

<script src="script.js"></script>
</body>
</html>
